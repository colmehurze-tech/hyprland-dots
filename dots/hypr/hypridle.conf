$iDIR = /home/sharland/.config/swaync/images/ja.png

general {
    lock_cmd = pidof hyprlock || hyprlock       # Perintah untuk mengunci
    before_sleep_cmd = loginctl lock-session    # Kunci sesi sebelum suspend
    
    # PERBAIKAN UTAMA: Tambahkan jeda 1 detik agar driver AMD siap 
    # lalu paksa semua monitor menyala kembali (DPMS ON)
    after_sleep_cmd = sleep 1 && hyprctl dispatch dpms on
    
    ignore_dbus_inhibit = false
}

# 1. REDUPKAN LAYAR (Power Saving)
# Menggunakan brightnessctl untuk meredupkan lampu latar
listener {
    timeout = 300
    on-timeout = brightnessctl -s set 1%
    on-resume = brightnessctl -r
}

# 2. PERINGATAN (Notification)
listener {
    timeout = 540
    on-timeout = notify-send -i $iDIR "Idle Warning" "System will sleep soon..."
    on-resume = notify-send -i $iDIR "Welcome Back" "Monitor reactive!"
}

# 3. LOCK SESSION & MATIKAN MONITOR
# Di sini kita mematikan monitor secara total via DPMS
listener {
    timeout = 600
    on-timeout = loginctl lock-session && hyprctl dispatch dpms off
    # Saat bangun, pastikan monitor dipaksa ON
    on-resume = hyprctl dispatch dpms on
}

# 4. MONITOR OFF SAAT TERKUNCI (Agresif tapi Aman)
# Dibuat agar tidak 'crash' dengan proses resume dari suspend
listener {
    timeout = 30
    on-timeout = pidof hyprlock && hyprctl dispatch dpms off
    # Perbaikan: Menghapus pengecekan pidof pada on-resume agar lebih responsif
    on-resume = hyprctl dispatch dpms on
}

# 5. SUSPEND OTOMATIS (Opsional)
# Jika benar-benar tidak ada aktivitas setelah 30 menit
listener {
    timeout = 1800
    on-timeout = systemctl suspend
}